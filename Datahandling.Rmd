---
title: "Multiyear RECS data handling"
author: "James Woods"
date: "07/16/2015"
output: html_document
---

```{r}
All2009 <- read.csv("2009/recs2009_public.csv")

All2005 <- read.csv("2005/RECS05alldata.csv")

```
Those two are simple but the 2001 data comes in many parts

```{r}
publicuse102001<-read.csv("2001/publicuse102001.csv", header=TRUE)  
publicuse2001<-read.csv("2001/publicuse2001.csv", header=TRUE)   
publicuse42001<-read.csv("2001/publicuse42001.csv", header=TRUE)  
publicuse72001<-read.csv("2001/publicuse72001.csv", header=TRUE)
publicuse112001<-read.csv("2001/publicuse112001.csv", header=TRUE)  
publicuse22001<-read.csv("2001/publicuse22001.csv", header=TRUE)  
publicuse52001<-read.csv("2001/publicuse52001.csv", header=TRUE)  
publicuse82001<-read.csv("2001/publicuse82001.csv", header=TRUE)
publicuse122001<-read.csv("2001/publicuse122001.csv", header=TRUE) 
publicuse32001<-read.csv("2001/publicuse32001.csv", header=TRUE)
publicuse62001<-read.csv("2001/publicuse62001.csv", header=TRUE)  
publicuse92001<-read.csv("2001/publicuse92001.csv", header=TRUE)

#DOEID is the merge key
library(reshape)
All2001<-merge_recurse(list(publicuse102001,publicuse112001,publicuse122001,publicuse2001,publicuse22001,publicuse32001,publicuse42001,publicuse52001,publicuse62001,publicuse72001,publicuse82001,publicuse92001))

library(stringr)
#Clean up name space
rm(list=c('publicuse102001','publicuse112001','publicuse122001','publicuse2001','publicuse22001','publicuse32001','publicuse42001','publicuse52001','publicuse62001','publicuse72001','publicuse82001','publicuse92001'))
```

# RECS 2009

Here is a list of the variables I would like from the 2009 RECS.  Include the imputation flag field, they start with a Z for all these variables.  For example, ZYEARMADE is for when they have to impute the variable YEARMADE.

There are some R models in RecodeScratch.R

Formatting ugly to keep the list easy to use.

This is just some example code.  Now commented out.
```{r}
# summary(All2009$DOEID)
# 
# All2009$DOEID<-as.factor(All2009$DOEID)  
# 
# library(plyr)
# #Region
# summary(All2009$REGIONC)
# table(All2009$REGIONC)
# 
# All2009$REGIONC<-revalue(as.factor(All2009$REGIONC),c("1"="NE", "2"="MidWest","3"="South","4"="West"))
# 
# #All2009$REGIONC[1:20]
# All2009[1:2,1:10]
# 
# 
# #Bedrooms
# summary(All2009$BEDROOMS)
# All2009$BEDROOMS[All2009$BEDROOMS==-2]<-NA
# All2009$BEDROOMS[All2009$BEDROOMS==-2]

```


DOEID
REGIONC
DIVISION
REPORTABLE_DOMAIN
TYPEHUQ
NWEIGHT
HDD65
CDD65
Climate_Region_Pub
AIA_Zone
METROMICRO
UR
KOWNRENT
CONDCOOP
YEARMADE
YEARMADERANGE
OCCUPYYRANGE
CONVERSION
ORIG1FAM
LOOKLIKE
NUMFLRS
NUMAPTS
NAPTFLRS
STORIES
TYPEHUQ4
BEDROOMS
NCOMBATH
NHAFBATH
OTHROOMS
TOTROOMS
STOVEN
STOVENFUEL
STOVE
STOVEFUEL
OVEN
OVENFUEL
OVENUSE
MICRO
AMTMICRO
OUTGRILL
OUTGRILLFUEL
TOASTER
NUMMEAL
FUELFOOD
NUMFRIG
TYPERFR1
SIZRFRI1
REFRIGT1
ICE
AGERFRI1
ESFRIG
REPLCFRI
TYPERFR2
SIZRFRI2
MONRFRI2
AGERFRI2
SEPFREEZ
NUMFREEZ
UPRTFRZR
SIZFREEZ
REPLCFRZ
UPRTFRZR2
SIZFREEZ2
AGEFRZR2
DISHWASH
DWASHUSE
AGEDW
ESDISHW
REPLCDW
CWASHER
TOPFRONT
WASHLOAD
WASHTEMP
RNSETEMP
AGECWASH
ESCWASH
DRYER
DRYRFUEL
DRYRUSE
AGECDRYER
TVCOLOR
TVSIZE1
TVTYPE1
CABLESAT1
COMBODVR1
DVR1
DIGITSTB1
PLAYSTA1
COMBOVCRDVD1
VCR1
DVD1
TVAUDIOSYS1
OTHERSTB1
TVONWD1
TVONWDWATCH1
TVONWE1
TVONWEWATCH1
TVSIZE2
TVTYPE2
CABLESAT2
COMBODVR2
DVR2
DIGITSTB2
PLAYSTA2
COMBOVCRDVD2
VCR2
DVD2
TVAUDIOSYS2
OTHERSTB2
TVONWD2
TVONWDWATCH2
TVONWE2
TVONWEWATCH2
COMPUTER
NUMPC
PCTYPE1
MONITOR1
TIMEON1
PCONOFF1
PCSLEEP1
PCTYPE2
MONITOR2
TIMEON2
PCONOFF2
PCSLEEP2
INTERNET
INDIALUP
INDSL
INCABLE
INSATEL
INWIRELESS
WELLPUMP
DIPSTICK
SWAMPCOL
AQUARIUM
BATTOOLS
BATCHRG
CHRGPLGT
ELECDEV
ELECCHRG
CHRGPLGE
HEATHOME
DNTHEAT
EQUIPNOHEAT
FUELNOHEAT
EQUIPM
FUELHEAT
EQUIPAGE
REPLCHT
HEATOTH
EQUIPAUX
REVERSE
WARMAIR
FURNFUEL
STEAMR
RADFUEL
PERMELEC
PIPELESS
PIPEFUEL
ROOMHEAT
RMHTFUEL
WOODKILN
HSFUEL
CARRYEL
CARRYKER
CHIMNEY
FPFUEL
RANGE
RNGFUEL
DIFEQUIP
DIFFUEL
EQMAMT
HEATROOM
THERMAIN
NUMTHERM
PROTHERM
AUTOHEATNITE
AUTOHEATDAY
TEMPHOME
TEMPGONE
TEMPNITE
MOISTURE
USEMOISTURE
NUMH2ONOTNK
NUMH2OHTRS
H2OTYPE1
FUELH2O
WHEATOTH
WHEATSIZ
WHEATAGE
WHEATBKT
H2OTYPE2
FUELH2O2
WHEATSIZ2
WHEATAGE2
AIRCOND
DNTAC
COOLTYPENOAC
COOLTYPE
DUCTS
CENACHP
ACOTHERS
AGECENAC
REPLCCAC
ACROOMS
USECENAC
THERMAINAC
PROTHERMAC
AUTOCOOLNITE
AUTOCOOLDAY
TEMPHOMEAC
TEMPGONEAC
TEMPNITEAC
NUMBERAC
WWACAGE
ESWWAC
REPLCWWAC
USEWWAC
NUMCFAN
USECFAN
TREESHAD
NOTMOIST
USENOTMOIST
SWIMPOOL
POOL
FUELPOOL
RECBATH
FUELTUB
LGT12
LGT12EE
LGT4
LGT4EE
LGT1
LGT1EE
NOUTLGTNT
LGTOEE
NGASLIGHT
INSTLCFL
SLDDRS
DOOR1SUM
WINDOWS
TYPEGLASS
NEWGLASS
ADQINSUL
INSTLINS
AGEINS
DRAFTY
INSTLWS
AGEWS
AUDIT
AGEAUD
USEEL
USENG
USELP
USEFO
USEKERO
USEWOOD
USESOLAR
USEOTH
ELWARM
ELECAUX
ELCOOL
ELWATER
ELFOOD
ELOTHER
UGWARM
UGASAUX
UGWATER
UGCOOK
UGOTH
LPWARM
LPGAUX
LPWATER
LPCOOK
LPOTHER
FOWARM
FOILAUX
FOWATER
FOOTHER
KRWARM
KEROAUX
KRWATER
KROTHER
WDWARM
WOODAUX
WDWATER
WDOTHUSE
SOLWARM
SOLARAUX
SOLWATER
SOLOTHER
OTHWARM
OTHERAUX
OTHWATER
OTHCOOK
ONSITE
ONSITEGRID
PELHEAT
PELHOTWA
PELCOOK
PELAC
PELLIGHT
OTHERWAYEL
PGASHEAT
PGASHTWA
PUGCOOK
PUGOTH
OTHERWAYNG
FOPAY
OTHERWAYFO
LPGPAY
OTHERWAYLPG
LPGDELV
KERODEL
KEROCASH
NOCRCASH
NKRGALNC
WOODLOGS
WDSCRAP
WDPELLET
WDOTHER
WOODAMT
NUMCORDS
KFUELOT
HHSEX
EMPLOYHH
SPOUSE
SDESCENT
Householder_Race
EDUCATION
NHSLDMEM
HHAGE
AGEHHMEMCAT2
AGEHHMEMCAT3
AGEHHMEMCAT4
AGEHHMEMCAT5
AGEHHMEMCAT6
AGEHHMEMCAT7
AGEHHMEMCAT8
AGEHHMEMCAT9
AGEHHMEMCAT10
AGEHHMEMCAT11
AGEHHMEMCAT12
AGEHHMEMCAT13
AGEHHMEMCAT14
HBUSNESS
ATHOME
TELLWORK
TELLDAYS
OTHWORK
WORKPAY
MONEYPY
POVERTY100
POVERTY150
HUPROJ
RENTHELP
TOTSQFT
TOTSQFT_EN
TOTHSQFT
TOTUSQFT
TOTCSQFT
TOTUCSQFT
KWH
KWHSPH
KWHCOL
KWHWTH
KWHRFG
KWHOTH 
BTUEL
BTUELSPH
BTUELCOL
BTUELWTH
BTUELRFG
BTUELOTH
DOLLAREL
DOLELSPH
DOLELCOL
DOLELWTH
DOLELRFG
DOLELOTH
CUFEETNG
CUFEETNGSPH
CUFEETNGWTH
CUFEETNGOTH
BTUNG
BTUNGSPH
BTUNGWTH
BTUNGOTH
DOLLARNG
DOLNGSPH
DOLNGWTH
DOLNGOTH
GALLONLP
GALLONLPSPH
GALLONLPWTH
GALLONLPOTH
BTULP
BTULPSPH
BTULPWTH
BTULPOTH
DOLLARLP
DOLLPSPH
DOLLPWTH
DOLLPOTH
GALLONFO
GALLONFOSPH
GALLONFOWTH
GALLONFOOTH
BTUFO
BTUFOSPH
BTUFOWTH
BTUFOOTH
DOLLARFO
DOLFOSPH
DOLFOWTH
DOLFOOTH
GALLONKER
GALLONKERSPH
GALLONKERWTH
GALLONKEROTH
BTUKER
BTUKERSPH
BTUKERWTH
BTUKEROTH
DOLLARKER
DOLKERSPH
DOLKERWTH
DOLKEROTH
BTUWOOD
CORDSWD
TOTALBTU
TOTALBTUSPH
TOTALBTUCOL
TOTALBTUWTH
TOTALBTURFG
TOTALBTUOTH
TOTALDOL
TOTALDOLSPH
TOTALDOLCOL
TOTALDOLWTH
TOTALDOLRFG
TOTALDOLOTH


Putting them all in one place so I can deal with them algorymically. 
```{r}

# Names2009 just contains the 2009 variable names we want
Cols2009<-read.table("Names2009.csv")
Cols2009$Status<-"Uncoded"

```

Now identify those that are clearly TF binary.  First look for those with only two codes

```{r}
NumberOfCodes<-apply(All2009[Cols2009$V1],MARGIN=2, FUN=function(x) length(table(x)))


OnlyTwoCodes<-names(NumberOfCodes[NumberOfCodes==2])
summary(All2009[OnlyTwoCodes])
```
Looking throught that list for things that are not TF and deleteing them from the list and recode the remaining ones to TF

```{r}
# Only one is UR.  Remove from the list.

OnlyTwoCodes<-OnlyTwoCodes[OnlyTwoCodes!="UR"]

#UR looks like it is coded
summary(All2009$UR)
Cols2009$Status[Cols2009$V1=="UR"]<-"Coded"

source("RECSHelper.R")

All2009[OnlyTwoCodes]<-apply(All2009[OnlyTwoCodes],MARGIN=2, FUN=function(x) to.TF(x,na.choice="KEEP"))

summary(All2009[OnlyTwoCodes])

Cols2009[is.element(Cols2009$V1,OnlyTwoCodes),]$Status<-"Coded"
```

Fixed all those in one fell swoop.

Lets check the ones with three potential codes

```{r}
OnlyThreeCodes<-names(NumberOfCodes[NumberOfCodes==3])

summary(All2009[OnlyThreeCodes])
```
My hope is to spot those that are TF with missing.  Lets refine it so we only have numerical codes with a min of exactly -2 and a max of exactly 1.

```{r}
#Returns true if three codes with max of 1 and min of -2
FindTFWMissing<-function(x){
  ret<-FALSE
  if(length(table(x))==3 & max(x)==1 & min(x)==-2) ret<-TRUE;
  ret
}

#tests
FindTFWMissing(All2009$GARGCOOL)
FindTFWMissing(All2009$FREEZER2)
FindTFWMissing(All2009$BASEUSE)
summary(All2009$BASEUSE)

#Broken somehow
table(apply(data.frame(All2009$GARGCOOL,All2009$FREEZER2,All2009$BASEUSE   ),MARGIN = 2, FUN = function(x) FindTFWMissing(x)))

table(apply(data.frame(All2009),MARGIN = 2, FUN = function(x) FindTFWMissing(x)))


```


# RECS 2005

Look for analogous variables in RECS205layoutAllData.csv

# RECS 2001

Code books are broken up by data file.  codebook82001.txt is for publicuse82001.csv.

Look for variables analogous to the ones in the 2009 list. 


